"use strict";(self.webpackChunkclg_web_frontend=self.webpackChunkclg_web_frontend||[]).push([[368],{328:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(9379),n=t(5043),c=t(579);const l=()=>{const[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(""),[d,o]=(0,n.useState)("list"),[h,u]=(0,n.useState)({studentId:"",selectedPayment:null}),[m,p]=(0,n.useState)(null),[j,x]=(0,n.useState)([]),[g,v]=(0,n.useState)(!1),[N,f]=(0,n.useState)({}),[b,y]=(0,n.useState)([]),[S,w]=(0,n.useState)({course:"",year:"",semester:"",status:"",sessionId:""});(0,n.useEffect)(()=>{C(),A()},[]);const A=async()=>{try{const e=localStorage.getItem("token"),s=await fetch("http://localhost:5000/api/erp/sessions",{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){const e=await s.json();y(e)}}catch(e){console.error("Error fetching sessions:",e)}},C=async()=>{try{const t=localStorage.getItem("token"),a=new URLSearchParams;S.course&&a.append("course",S.course),S.year&&a.append("year",S.year),S.semester&&a.append("semester",S.semester),S.status&&a.append("status",S.status),S.sessionId&&a.append("sessionId",S.sessionId);const n="http://localhost:5000/api/receipts".concat(a.toString()?"?"+a.toString():""),c=await fetch(n,{headers:{Authorization:"Bearer ".concat(t)}});if(c.ok){const a=await c.json();s(a);const n=[],l={};for(const e of a)e.studentName&&"undefined undefined"!==e.studentName&&""!==e.studentName.trim()?l[e.studentId]=e.studentName:n.includes(e.studentId)||n.push(e.studentId);for(const s of n)try{const e=await fetch("http://localhost:5000/api/payments/student-details/".concat(s),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){const t=await e.json();l[s]=t.name||"Unknown"}}catch(e){console.error("Error fetching student name:",e),l[s]="Unknown"}f(l)}}catch(e){console.error("Error fetching receipts:",e),i("Error fetching receipts: "+e.message)}},I=e=>{const{name:s,value:t}=e.target;w(e=>(0,a.A)((0,a.A)({},e),{},{[s]:t}))};return(0,c.jsxs)("div",{className:"manage-receipts",children:[(0,c.jsx)("h2",{children:"Manage Fee Receipts"}),r&&(0,c.jsxs)("div",{className:"message",children:[r,(0,c.jsx)("button",{onClick:()=>i(""),className:"close-message",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"filters-section",children:[(0,c.jsx)("h3",{children:"Filters"}),(0,c.jsxs)("div",{className:"filters-grid",children:[(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Course:"}),(0,c.jsxs)("select",{name:"course",value:S.course,onChange:I,children:[(0,c.jsx)("option",{value:"",children:"All Courses"}),(0,c.jsx)("option",{value:"B.A",children:"B.A"}),(0,c.jsx)("option",{value:"B.Sc",children:"B.Sc"}),(0,c.jsx)("option",{value:"B.Ed",children:"B.Ed"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Year:"}),(0,c.jsxs)("select",{name:"year",value:S.year,onChange:I,children:[(0,c.jsx)("option",{value:"",children:"All Years"}),(0,c.jsx)("option",{value:"1",children:"1st Year"}),(0,c.jsx)("option",{value:"2",children:"2nd Year"}),(0,c.jsx)("option",{value:"3",children:"3rd Year"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Semester:"}),(0,c.jsxs)("select",{name:"semester",value:S.semester,onChange:I,children:[(0,c.jsx)("option",{value:"",children:"All Semesters"}),(0,c.jsx)("option",{value:"1",children:"1st Semester"}),(0,c.jsx)("option",{value:"2",children:"2nd Semester"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Status:"}),(0,c.jsxs)("select",{name:"status",value:S.status,onChange:I,children:[(0,c.jsx)("option",{value:"",children:"All Status"}),(0,c.jsx)("option",{value:"active",children:"Active"}),(0,c.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Session:"}),(0,c.jsxs)("select",{name:"sessionId",value:S.sessionId,onChange:I,children:[(0,c.jsx)("option",{value:"",children:"All Sessions"}),b.map(e=>(0,c.jsxs)("option",{value:e._id,children:[e.sessionId," (",new Date(e.startDate).getFullYear(),"-",new Date(e.endDate).getFullYear(),")"]},e._id))]})]}),(0,c.jsx)("div",{className:"filter-group",children:(0,c.jsx)("button",{onClick:()=>{C()},className:"apply-filters-btn",children:"Apply Filters"})})]})]}),(0,c.jsxs)("div",{className:"receipts-section",children:[(0,c.jsx)("h3",{children:"Receipts List"}),t?(0,c.jsx)("p",{children:"Loading receipts..."}):e.length>0?(0,c.jsx)("div",{className:"table-container",children:(0,c.jsxs)("table",{className:"receipts-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Receipt No"}),(0,c.jsx)("th",{children:"Student ID"}),(0,c.jsx)("th",{children:"Student Name"}),(0,c.jsx)("th",{children:"Course"}),(0,c.jsx)("th",{children:"Year/Sem"}),(0,c.jsx)("th",{children:"Session"}),(0,c.jsx)("th",{children:"Amount"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Date"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:e.map(e=>{var s;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.receiptNumber}),(0,c.jsx)("td",{children:e.studentId}),(0,c.jsx)("td",{children:N[e.studentId]||"Loading..."}),(0,c.jsx)("td",{children:e.course}),(0,c.jsxs)("td",{children:[e.year,"/",e.semester]}),(0,c.jsx)("td",{children:(null===(s=e.sessionId)||void 0===s?void 0:s.sessionId)||"N/A"}),(0,c.jsxs)("td",{children:["\u20b9",e.amount]}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"status-badge ".concat("active"===e.status?"status-active":"status-cancelled"),children:e.status})}),(0,c.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,c.jsxs)("td",{children:[(0,c.jsx)("button",{onClick:()=>(async e=>{try{const s=localStorage.getItem("token"),t=await fetch("http://localhost:5000/api/receipts/".concat(e,"/download"),{headers:{Authorization:"Bearer ".concat(s)}});if(t.ok){const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="receipt_".concat(e,".pdf"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}else i("Failed to download receipt")}catch(s){i("Error downloading receipt: "+s.message)}})(e._id),className:"action-button download-button",children:"Download"}),"active"===e.status&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:()=>(async e=>{try{const s=localStorage.getItem("token");(await fetch("http://localhost:5000/api/receipts/".concat(e,"/duplicate"),{method:"POST",headers:{Authorization:"Bearer ".concat(s)}})).ok?(i("Duplicate receipt generated successfully"),C()):i("Failed to duplicate receipt")}catch(s){i("Error duplicating receipt: "+s.message)}})(e._id),className:"action-button duplicate-button",children:"Duplicate"}),(0,c.jsx)("button",{onClick:()=>(async e=>{try{const s=localStorage.getItem("token");(await fetch("http://localhost:5000/api/receipts/".concat(e,"/cancel"),{method:"PUT",headers:{Authorization:"Bearer ".concat(s)},body:JSON.stringify({reason:"Cancelled by admin"})})).ok?(i("Receipt cancelled successfully"),C()):i("Failed to cancel receipt")}catch(s){i("Error cancelling receipt: "+s.message)}})(e._id),className:"action-button cancel-button",children:"Cancel"})]})]})]},e._id)})})]})}):(0,c.jsx)("p",{className:"no-receipts",children:"No receipts found."})]})]})}},1478:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(5043),n=t(5496),c=t(579);const l=e=>{let{onStudentSelect:s,placeholder:t="Search student by ID, name, class..."}=e;const[l,r]=(0,a.useState)(""),[i,d]=(0,a.useState)([]),[o,h]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=setTimeout(async()=>{if(l.length<2)return void d([]);h(!0);const e=await n.WG.searchStudent(l);if(h(!1),e.success){const s=e.data.filter(e=>e.studentId&&""!==e.studentId.trim());d(s)}else d([])},300);return()=>clearTimeout(e)},[l]);return(0,c.jsxs)("div",{className:"student-search",children:[(0,c.jsx)("input",{type:"text",value:l,onChange:e=>r(e.target.value),onFocus:()=>m(!0),onBlur:()=>setTimeout(()=>m(!1),200),placeholder:t,className:"student-search-input"}),o&&(0,c.jsx)("div",{className:"loading",children:"Searching..."}),u&&i.length>0&&(0,c.jsx)("ul",{className:"suggestions-list",children:i.map(e=>(0,c.jsx)("li",{onClick:()=>(e=>{r("".concat(e.studentId," - ").concat(e.name)),m(!1),s(e)})(e),className:"suggestion-item",children:(0,c.jsxs)("div",{className:"student-info",children:[(0,c.jsx)("span",{className:"student-id",children:e.studentId}),(0,c.jsx)("span",{className:"student-name",children:e.name}),(0,c.jsxs)("span",{className:"student-class",children:[e.class," - ",e.session]})]})},e._id))})]})}},1981:(e,s,t)=>{t.d(s,{A:()=>r});var a=t(9379),n=t(5043),c=(t(4706),t(579));const l=e=>{let{isOpen:s,title:t,message:a,onConfirm:n,onCancel:l}=e;return s?(0,c.jsx)("div",{className:"modal-overlay",children:(0,c.jsxs)("div",{className:"confirmation-modal",children:[(0,c.jsx)("div",{className:"modal-header",children:(0,c.jsx)("h3",{children:t})}),(0,c.jsx)("div",{className:"modal-body",children:(0,c.jsx)("p",{children:a})}),(0,c.jsxs)("div",{className:"modal-footer",children:[(0,c.jsx)("button",{className:"btn btn-secondary",onClick:l,children:"Cancel"}),(0,c.jsx)("button",{className:"btn btn-danger",onClick:n,children:"Confirm"})]})]})}):null},r=()=>{const[e,s]=(0,n.useState)([]),[t,r]=(0,n.useState)(!1),[i,d]=(0,n.useState)(""),[o,h]=(0,n.useState)([]),[u,m]=(0,n.useState)({course:"",year:"",semester:"",status:"",sessionId:""}),[p,j]=(0,n.useState)(!1),[x,g]=(0,n.useState)(null),[v,N]=(0,n.useState)("");(0,n.useEffect)(()=>{b(),f()},[]);const f=async()=>{try{const e=localStorage.getItem("token"),s=await fetch("http://localhost:5000/api/erp/sessions",{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){const e=await s.json();h(e)}}catch(e){console.error("Error fetching sessions:",e)}},b=async()=>{try{r(!0);const e=localStorage.getItem("token"),t=new URLSearchParams(u).toString(),a="http://localhost:5000/api/receipts".concat(t?"?".concat(t):""),n=await fetch(a,{headers:{Authorization:"Bearer ".concat(e)}});if(n.ok){const e=await n.json();s(e)}else d("Failed to fetch receipts")}catch(e){console.error("Error fetching receipts:",e),d("Error fetching receipts: "+e.message)}finally{r(!1)}},y=e=>{const{name:s,value:t}=e.target;m(e=>(0,a.A)((0,a.A)({},e),{},{[s]:t}))},S="admin"===localStorage.getItem("role");return(0,c.jsxs)("div",{className:"cancel-receipts-container",children:[(0,c.jsxs)("div",{className:"cancel-receipts-header",children:[(0,c.jsx)("h1",{children:"Cancel Receipts"}),(0,c.jsx)("p",{children:"View and cancel issued fee receipts. This action cannot be undone."})]}),i&&(0,c.jsx)("div",{className:"message ".concat(i.includes("Error")||i.includes("Failed")?"error":""),children:i}),!S&&(0,c.jsx)("div",{className:"warning-message",children:(0,c.jsx)("p",{children:"\u26a0\ufe0f Only administrators can cancel receipts."})}),S&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"filters-section",children:[(0,c.jsx)("h3",{children:"Filters"}),(0,c.jsxs)("div",{className:"filters-grid",children:[(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Course:"}),(0,c.jsxs)("select",{name:"course",value:u.course,onChange:y,children:[(0,c.jsx)("option",{value:"",children:"All Courses"}),(0,c.jsx)("option",{value:"B.A",children:"B.A"}),(0,c.jsx)("option",{value:"B.Sc",children:"B.Sc"}),(0,c.jsx)("option",{value:"B.Ed",children:"B.Ed"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Year:"}),(0,c.jsxs)("select",{name:"year",value:u.year,onChange:y,children:[(0,c.jsx)("option",{value:"",children:"All Years"}),(0,c.jsx)("option",{value:"1",children:"1st Year"}),(0,c.jsx)("option",{value:"2",children:"2nd Year"}),(0,c.jsx)("option",{value:"3",children:"3rd Year"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Semester:"}),(0,c.jsxs)("select",{name:"semester",value:u.semester,onChange:y,children:[(0,c.jsx)("option",{value:"",children:"All Semesters"}),(0,c.jsx)("option",{value:"1",children:"1st Semester"}),(0,c.jsx)("option",{value:"2",children:"2nd Semester"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Status:"}),(0,c.jsxs)("select",{name:"status",value:u.status,onChange:y,children:[(0,c.jsx)("option",{value:"",children:"All Status"}),(0,c.jsx)("option",{value:"active",children:"Active"}),(0,c.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Session:"}),(0,c.jsxs)("select",{name:"sessionId",value:u.sessionId,onChange:y,children:[(0,c.jsx)("option",{value:"",children:"All Sessions"}),o.map(e=>(0,c.jsxs)("option",{value:e._id,children:[e.sessionId," (",new Date(e.startDate).getFullYear(),"-",new Date(e.endDate).getFullYear(),")"]},e._id))]})]}),(0,c.jsx)("div",{className:"filter-group",children:(0,c.jsx)("button",{onClick:()=>{b()},className:"apply-filters-button",children:"Apply Filters"})})]})]}),(0,c.jsxs)("div",{className:"cancel-receipts-list",children:[(0,c.jsx)("h3",{children:"Receipts List"}),t?(0,c.jsx)("div",{className:"loading",children:"Loading receipts..."}):(0,c.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:e.length>0?(0,c.jsxs)("table",{className:"cancel-receipts-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Receipt No"}),(0,c.jsx)("th",{children:"Student ID"}),(0,c.jsx)("th",{children:"Student Name"}),(0,c.jsx)("th",{children:"Session"}),(0,c.jsx)("th",{children:"Amount"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Date"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:e.map(e=>{var s;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.receiptNumber}),(0,c.jsx)("td",{children:e.studentId}),(0,c.jsx)("td",{children:e.studentName}),(0,c.jsx)("td",{children:(null===(s=e.sessionId)||void 0===s?void 0:s.sessionId)||"N/A"}),(0,c.jsxs)("td",{children:["\u20b9",e.amount]}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"status-badge ".concat("active"===e.status?"status-active":"status-cancelled"),children:e.status})}),(0,c.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,c.jsxs)("td",{children:[(0,c.jsx)("button",{onClick:()=>(async e=>{try{const s=localStorage.getItem("token"),t=await fetch("http://localhost:5000/api/receipts/".concat(e,"/download"),{headers:{Authorization:"Bearer ".concat(s)}});if(t.ok){const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="receipt_".concat(e,".pdf"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}else d("Failed to download receipt")}catch(s){d("Error downloading receipt: "+s.message)}})(e._id),className:"action-button download-button",children:"Download"}),"active"===e.status&&(0,c.jsx)("button",{onClick:()=>(e=>{g(e),N(""),j(!0)})(e),className:"action-button cancel-button",children:"Cancel"})]})]},e._id)})})]}):(0,c.jsx)("p",{className:"no-receipts",children:"No receipts found."})})]})]}),(0,c.jsx)(l,{isOpen:p,title:"Confirm Cancellation",message:(0,c.jsxs)("div",{children:[(0,c.jsxs)("p",{children:["Are you sure you want to cancel receipt ",(0,c.jsx)("strong",{children:null===x||void 0===x?void 0:x.receiptNumber}),"? This action cannot be undone."]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:"Reason for Cancellation (Required):"}),(0,c.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),rows:"4",placeholder:"Please provide a detailed reason for cancelling this receipt...",required:!0})]})]}),onConfirm:async()=>{if(v.trim())try{const e=localStorage.getItem("token");(await fetch("http://localhost:5000/api/receipts/".concat(x._id,"/cancel"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({reason:v})})).ok?(d("Receipt cancelled successfully!"),b(),j(!1),g(null)):d("Failed to cancel receipt")}catch(e){d("Error cancelling receipt: "+e.message)}else d("Please provide a reason for cancellation")},onCancel:()=>j(!1),confirmText:"Cancel Receipt",cancelText:"Keep Receipt"})]})}},3383:(e,s,t)=>{t.d(s,{A:()=>h});var a=t(9379),n=t(5043),c=t(1478),l=t(7265),r=t(579);const i=e=>{let{receipt:s,onClose:t,onPrint:a}=e;return s?(0,r.jsx)("div",{className:"receipt-viewer-overlay",children:(0,r.jsxs)("div",{className:"receipt-viewer",children:[(0,r.jsxs)("div",{className:"receipt-header",children:[(0,r.jsx)("h2",{children:"College Fee Receipt"}),(0,r.jsx)("button",{className:"close-btn",onClick:t,children:"\xd7"})]}),(0,r.jsxs)("div",{className:"receipt-content",children:[(0,r.jsxs)("div",{className:"receipt-details",children:[(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Receipt Number:"}),(0,r.jsx)("span",{className:"value",children:s.receiptNumber})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Date:"}),(0,r.jsx)("span",{className:"value",children:new Date(s.date).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Student ID:"}),(0,r.jsx)("span",{className:"value",children:s.studentId})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Student Name:"}),(0,r.jsx)("span",{className:"value",children:s.studentName})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Payment Mode:"}),(0,r.jsx)("span",{className:"value",children:s.paymentMode})]}),(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Amount Paid:"}),(0,r.jsxs)("span",{className:"value",children:["\u20b9",s.amount.toLocaleString()]})]}),s.remarks&&(0,r.jsxs)("div",{className:"detail-row",children:[(0,r.jsx)("span",{className:"label",children:"Remarks:"}),(0,r.jsx)("span",{className:"value",children:s.remarks})]})]}),s.breakdown&&s.breakdown.length>0&&(0,r.jsxs)("div",{className:"fee-breakdown",children:[(0,r.jsx)("h3",{children:"Fee Breakdown"}),(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Fee Head"}),(0,r.jsx)("th",{children:"Amount"})]})}),(0,r.jsxs)("tbody",{children:[s.breakdown.map((e,s)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.head}),(0,r.jsxs)("td",{children:["\u20b9",e.amount.toLocaleString()]})]},s)),(0,r.jsxs)("tr",{className:"total-row",children:[(0,r.jsx)("td",{children:(0,r.jsx)("strong",{children:"Total"})}),(0,r.jsx)("td",{children:(0,r.jsxs)("strong",{children:["\u20b9",s.amount.toLocaleString()]})})]})]})]})]})]}),(0,r.jsxs)("div",{className:"receipt-footer",children:[(0,r.jsx)("p",{children:"This is a computer generated receipt."}),(0,r.jsxs)("div",{className:"receipt-actions",children:[(0,r.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Print Receipt"}),(0,r.jsx)("button",{className:"btn btn-primary",onClick:t,children:"Close"})]})]})]})}):null};var d=t(4706),o=t(5496);const h=()=>{const[e,s]=(0,n.useState)(null),[t,h]=(0,n.useState)(null),[u,m]=(0,n.useState)([]),[p,j]=(0,n.useState)(null),[x,g]=(0,n.useState)({amount:"",paymentMode:"",remarks:""}),[v,N]=(0,n.useState)(null),[f,b]=(0,n.useState)(!1),[y,S]=(0,n.useState)(null),[w,A]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e&&e.studentId?(C(),I(),S(null)):!e||e.studentId&&""!==e.studentId.trim()?(S(null),h(null),j(null),m([])):(S({message:"Selected student has no student ID, fee summary cannot be displayed.",type:"warning"}),h(null),j(null),m([]))},[e]),(0,n.useEffect)(()=>{e&&e.studentId&&p?k():m([])},[e,p]);const C=async()=>{if(!e||!e.studentId)return;A(!0);const s=await o.WG.getStudentDetails(e.studentId,"student");if(A(!1),s.success){const e=s.data;h({phone:e.mobileNumber||"N/A",email:e.email||"N/A",address:e.address?"".concat(e.address.street,", ").concat(e.address.city,", ").concat(e.address.state," - ").concat(e.address.pincode):"N/A",dob:e.dateOfBirth?new Date(e.dateOfBirth).toLocaleDateString():"N/A",fatherName:e.guardianName||"N/A",motherName:"N/A"})}else S({message:"Failed to fetch student details",type:"error"}),h(null)},I=async()=>{if(!e||!e.class)return;const s=e.class.split(" ")[0];try{const e=localStorage.getItem("token"),t=await fetch("http://localhost:5000/api/fees/".concat(s),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){const e=await t.json();j(e)}else j(null)}catch(t){console.error("Error fetching fee structure:",t),j(null)}},k=async()=>{if(!e||!e.studentId)return S({message:"No valid student selected for fetching fees",type:"error"}),void m([]);A(!0);const s=await o.WG.getStudentFees(e.studentId);if(A(!1),s.success){const e=D(s.data);m(e)}else S({message:"Failed to fetch student fees",type:"error"}),m([])},D=e=>{let s=[];s=p&&p.feeComponents?Object.entries(p.feeComponents).map(e=>{let[s,t]=e;return{head:s.charAt(0).toUpperCase()+s.slice(1).replace(/([A-Z])/g," $1"),total:Math.round(100*(parseFloat(t)||0))/100}}):[{head:"Tuition Fee",total:5e3},{head:"Library Fee",total:500},{head:"Sports Fee",total:1e3},{head:"Exam Fee",total:1500}];let t=Math.round(100*e.reduce((e,s)=>"Paid"===s.status?e+(parseFloat(s.amount)||0):e,0))/100;return s.map(e=>{const s=Math.min(t,e.total);return t-=s,{head:e.head,amount:e.total,paid:Math.round(100*s)/100,balance:Math.round(100*Math.max(0,e.total-s))/100}})},F=e=>{const{name:s,value:t}=e.target;g(e=>(0,a.A)((0,a.A)({},e),{},{[s]:t}))},R=u.reduce((e,s)=>e+s.balance,0);return(0,r.jsxs)("div",{className:"menu-content",children:[(0,r.jsx)("h1",{children:"Collect Fees"}),y&&(0,r.jsx)(d.A,{message:y.message,type:y.type,onClose:()=>S(null)}),(0,r.jsxs)("div",{className:"collect-fees-container",children:[(0,r.jsx)("div",{className:"search-section",children:(0,r.jsx)(c.A,{onStudentSelect:s,placeholder:"Search student to collect fees..."})}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"student-info",children:[(0,r.jsxs)("h3",{children:["Student: ",e.name," ",e.studentId?"(".concat(e.studentId,")"):"(No Student ID)"]}),(0,r.jsxs)("p",{children:["Class: ",e.class," | Session: ",e.session]}),t&&(0,r.jsxs)("div",{className:"additional-details",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Phone:"})," ",t.phone||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",t.email||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Address:"})," ",t.address||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Date of Birth:"})," ",t.dob||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Father's Name:"})," ",t.fatherName||"N/A"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Mother's Name:"})," ",t.motherName||"N/A"]})]})]}),w?(0,r.jsx)("div",{className:"loading",children:"Loading fee details..."}):(0,r.jsx)(l.A,{fees:u}),(0,r.jsx)("div",{className:"payment-section",children:f?(0,r.jsx)(i,{receipt:v,onClose:()=>b(!1),onPrint:()=>S({message:"Receipt printed successfully!",type:"success"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:"Payment Entry"}),(0,r.jsxs)("form",{onSubmit:async s=>{s.preventDefault();const t=u.reduce((e,s)=>e+s.balance,0),a=parseFloat(x.amount);if(a<=0||a>t)return void S({message:"Invalid payment amount",type:"error"});if(!x.paymentMode)return void S({message:"Please select payment mode",type:"error"});if(A(!0),!e||!e.studentId)return S({message:"No valid student selected",type:"error"}),void A(!1);const n={studentId:e.studentId,course:e.class.split(" ")[0],year:parseInt(e.class.split(" ")[1])||1,semester:1,paymentType:"year",paymentMethod:x.paymentMode.toLowerCase(),remarks:x.remarks||"",amount:a,status:"Paid",paymentDate:(new Date).toISOString()},c=await o.WG.collectFee(n);if(A(!1),c.success){const s=await o.WG.generateReceipt(c.data.paymentId);s.success?(N({receiptNumber:s.data.receipt.receiptNumber,date:s.data.receipt.issuedDate,studentId:e.studentId,studentName:e.name,amount:a,paymentMode:x.paymentMode,remarks:x.remarks||"No remarks",paymentId:c.data.paymentId,breakdown:u.filter(e=>e.balance>0).map(e=>({head:e.head,amount:Math.min(e.balance,a)}))}),S({message:'Payment collected successfully! Click "Generate Receipt" to view/print the receipt.',type:"success"})):S({message:"Payment collected but failed to generate receipt",type:"warning"}),g({amount:"",paymentMode:"",remarks:""}),k()}else S({message:c.error,type:"error"})},className:"payment-form",children:[(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{children:"Amount to Pay (\u20b9):"}),(0,r.jsx)("input",{type:"number",name:"amount",value:x.amount,onChange:F,min:"0",max:R,step:"0.01",required:!0,disabled:!e||!e.studentId}),(0,r.jsxs)("small",{children:["Total due: \u20b9",R.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{children:"Payment Mode:"}),(0,r.jsxs)("select",{name:"paymentMode",value:x.paymentMode,onChange:F,required:!0,disabled:!e||!e.studentId,children:[(0,r.jsx)("option",{value:"",children:"Select payment mode"}),["Online","Offline"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{className:"form-group",children:[(0,r.jsx)("label",{children:"Remarks (Optional):"}),(0,r.jsx)("textarea",{name:"remarks",value:x.remarks,onChange:F,rows:"3",placeholder:"Enter any remarks...",disabled:!e||!e.studentId})]}),(0,r.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:w||!x.amount||!x.paymentMode||!e||!e.studentId,children:w?"Processing...":"Collect Fees"})]}),v&&(0,r.jsxs)("div",{className:"receipt-preview",children:[(0,r.jsx)("h3",{children:"Receipt Generated Successfully!"}),(0,r.jsxs)("div",{className:"receipt-info",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Receipt No:"})," ",v.receiptNumber]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Amount:"})," \u20b9",v.amount.toLocaleString()]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Payment Mode:"})," ",v.paymentMode]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Date:"})," ",new Date(v.date).toLocaleDateString()]})]}),(0,r.jsx)("button",{className:"btn btn-secondary",onClick:()=>b(!0),children:"Generate Receipt"})]})]})})]})]})]})}},4706:(e,s,t)=>{t.d(s,{A:()=>n});t(5043);var a=t(579);const n=e=>{let{message:s,type:t,onClose:n}=e;return(0,a.jsxs)("div",{className:"alert ".concat((()=>{switch(t){case"success":return"alert-success";case"error":return"alert-error";case"warning":return"alert-warning";default:return"alert-info"}})()),children:[(0,a.jsx)("span",{className:"alert-message",children:s}),n&&(0,a.jsx)("button",{className:"alert-close",onClick:n,children:"\xd7"})]})}},5668:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(9379),n=t(5043),c=t(579);const l=()=>{const[e,s]=(0,n.useState)([]),[t,l]=(0,n.useState)(!1),[r,i]=(0,n.useState)(""),[d,o]=(0,n.useState)([]),[h,u]=(0,n.useState)([]),[m,p]=(0,n.useState)({course:"",year:"",semester:"",status:"",sessionId:""});(0,n.useEffect)(()=>{x(),j()},[]);const j=async()=>{try{const e=localStorage.getItem("token"),s=await fetch("http://localhost:5000/api/erp/sessions",{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){const e=await s.json();u(e)}}catch(e){console.error("Error fetching sessions:",e)}},x=async()=>{try{l(!0);const e=localStorage.getItem("token"),t=new URLSearchParams(m).toString(),a="http://localhost:5000/api/receipts/duplicates/all".concat(t?"?".concat(t):""),n=await fetch(a,{headers:{Authorization:"Bearer ".concat(e)}});if(n.ok){const e=await n.json();s(e)}else i("Failed to fetch duplicate receipts")}catch(e){console.error("Error fetching duplicate receipts:",e),i("Error fetching duplicate receipts: "+e.message)}finally{l(!1)}},g=e=>{const{name:s,value:t}=e.target;p(e=>(0,a.A)((0,a.A)({},e),{},{[s]:t}))};return(0,c.jsxs)("div",{className:"duplicate-receipts-container",children:[(0,c.jsxs)("div",{className:"duplicate-receipts-header",children:[(0,c.jsx)("h1",{children:"Duplicate Receipts"}),(0,c.jsx)("p",{children:"View and manage automatically generated duplicate receipts."})]}),r&&(0,c.jsx)("div",{className:"message ".concat(r.includes("Error")||r.includes("Failed")?"error":""),children:r}),(0,c.jsxs)("div",{className:"filters-section",children:[(0,c.jsx)("h3",{children:"Filters"}),(0,c.jsxs)("div",{className:"filters-grid",children:[(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Course:"}),(0,c.jsxs)("select",{name:"course",value:m.course,onChange:g,children:[(0,c.jsx)("option",{value:"",children:"All Courses"}),(0,c.jsx)("option",{value:"B.A",children:"B.A"}),(0,c.jsx)("option",{value:"B.Sc",children:"B.Sc"}),(0,c.jsx)("option",{value:"B.Ed",children:"B.Ed"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Year:"}),(0,c.jsxs)("select",{name:"year",value:m.year,onChange:g,children:[(0,c.jsx)("option",{value:"",children:"All Years"}),(0,c.jsx)("option",{value:"1",children:"1st Year"}),(0,c.jsx)("option",{value:"2",children:"2nd Year"}),(0,c.jsx)("option",{value:"3",children:"3rd Year"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Semester:"}),(0,c.jsxs)("select",{name:"semester",value:m.semester,onChange:g,children:[(0,c.jsx)("option",{value:"",children:"All Semesters"}),(0,c.jsx)("option",{value:"1",children:"1st Semester"}),(0,c.jsx)("option",{value:"2",children:"2nd Semester"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Status:"}),(0,c.jsxs)("select",{name:"status",value:m.status,onChange:g,children:[(0,c.jsx)("option",{value:"",children:"All Status"}),(0,c.jsx)("option",{value:"active",children:"Active"}),(0,c.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]}),(0,c.jsxs)("div",{className:"filter-group",children:[(0,c.jsx)("label",{children:"Session:"}),(0,c.jsxs)("select",{name:"sessionId",value:m.sessionId,onChange:g,children:[(0,c.jsx)("option",{value:"",children:"All Sessions"}),h.map(e=>(0,c.jsxs)("option",{value:e._id,children:[e.sessionId," (",new Date(e.startDate).getFullYear(),"-",new Date(e.endDate).getFullYear(),")"]},e._id))]})]}),(0,c.jsx)("div",{className:"filter-group",children:(0,c.jsx)("button",{onClick:()=>{x()},className:"apply-filters-button",children:"Apply Filters"})})]})]}),(0,c.jsxs)("div",{className:"duplicate-receipts-list",children:[(0,c.jsx)("h3",{children:"Duplicate Receipts List"}),t?(0,c.jsx)("div",{className:"loading",children:"Loading duplicate receipts..."}):(0,c.jsx)("div",{style:{maxHeight:"600px",overflowY:"auto"},children:e.length>0?(0,c.jsxs)("table",{className:"duplicate-receipts-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Duplicate Receipt No"}),(0,c.jsx)("th",{children:"Original Receipt No"}),(0,c.jsx)("th",{children:"Student ID"}),(0,c.jsx)("th",{children:"Student Name"}),(0,c.jsx)("th",{children:"Session"}),(0,c.jsx)("th",{children:"Amount"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Generated Date"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:e.map(e=>{var s,t;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.receiptNumber}),(0,c.jsx)("td",{children:(null===(s=e.originalReceiptId)||void 0===s?void 0:s.receiptNumber)||"N/A"}),(0,c.jsx)("td",{children:e.studentId}),(0,c.jsx)("td",{children:e.studentName}),(0,c.jsx)("td",{children:(null===(t=e.sessionId)||void 0===t?void 0:t.sessionId)||"N/A"}),(0,c.jsxs)("td",{children:["\u20b9",e.amount]}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"status-badge ".concat("active"===e.status?"status-active":"status-cancelled"),children:e.status})}),(0,c.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,c.jsxs)("td",{children:[(0,c.jsx)("button",{onClick:()=>(async e=>{try{const s=localStorage.getItem("token"),t=await fetch("http://localhost:5000/api/receipts/".concat(e,"/download"),{headers:{Authorization:"Bearer ".concat(s)}});if(t.ok){const s=await t.blob(),a=window.URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download="duplicate_receipt_".concat(e,".pdf"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}else i("Failed to download receipt")}catch(s){i("Error downloading receipt: "+s.message)}})(e._id),className:"action-button download-button",children:"Download"}),"active"===e.status&&(0,c.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to cancel this duplicate receipt?"))try{const s=localStorage.getItem("token");(await fetch("http://localhost:5000/api/receipts/".concat(e,"/cancel"),{method:"PUT",headers:{Authorization:"Bearer ".concat(s)}})).ok?(i("Duplicate receipt cancelled successfully!"),x()):i("Failed to cancel receipt")}catch(s){i("Error cancelling receipt: "+s.message)}})(e._id),className:"action-button cancel-button",children:"Cancel"})]})]},e._id)})})]}):(0,c.jsx)("p",{className:"no-duplicate-receipts",children:"No duplicate receipts found."})})]})]})}}}]);
//# sourceMappingURL=368.436f78fa.chunk.js.map